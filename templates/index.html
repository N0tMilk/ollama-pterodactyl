<!DOCTYPE html>
<html>
<head>
  <title>Ollama Web Chat</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
<div class="container">
  <h1>Ollama Web Chat</h1>
  <select id="model">
    {% for m in models %}
    <option value="{{ m }}">{{ m }}</option>
    {% endfor %}
  </select>
  <div id="chat-box"></div>
  <div class="input-container">
    <textarea id="prompt" placeholder="Type your question..."></textarea>
    <button id="ask">Ask</button>
  </div>
</div>

<script>
const chatBox = document.getElementById("chat-box");
const askBtn = document.getElementById("ask");
const promptInput = document.getElementById("prompt");
const modelSelect = document.getElementById("model");

function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = cls;
  div.textContent = text;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

askBtn.addEventListener("click", sendMessage);
promptInput.addEventListener("keydown", (e) => { if (e.key === "Enter" && !e.shiftKey) sendMessage(); });

async function sendMessage() {
  const prompt = promptInput.value.trim();
  if (!prompt) return;
  addMessage("You: " + prompt, "user");
  const botDiv = document.createElement("div");
  botDiv.className = "ai";
  chatBox.appendChild(botDiv);
  const model = modelSelect.value;
  promptInput.value = "";

  const formData = new FormData();
  formData.append("model", model);
  formData.append("prompt", prompt);

  const response = await fetch("/chat", { method: "POST", body: formData });
  const reader = response.body.getReader();
  const decoder = new TextDecoder();
  let buffer = "";

  while(true){
    const { done, value } = await reader.read();
    if(done) break;
    buffer += decoder.decode(value);
    botDiv.textContent = buffer;
    chatBox.scrollTop = chatBox.scrollHeight;
  }
}
</script>
</body>
</html>
